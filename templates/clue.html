{% extends "base.html" %}

{% block title %}{{ title or ("Clue " ~ clue_id) }}{% endblock %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-8">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h1 class="mb-0">{{ title or ("Clue " ~ clue_id) }}</h1>
        <span class="badge bg-primary fs-6">Variant {{ variant }}</span>
      </div>

      <div class="my-3">
        <div class="d-flex justify-content-between align-items-center">
          <div class="flex-grow-1 me-3">
            <div class="progress" role="progressbar" aria-label="Hunt progress" aria-valuemin="0" aria-valuemax="{{ GAME_SETTINGS.FINAL_CLUE_ID }}" data-current="{{ clue_id }}" data-total="{{ GAME_SETTINGS.FINAL_CLUE_ID }}" id="huntProgress">
              <div class="progress-bar" style="width: 0%"></div>
            </div>
            <div class="small text-muted mt-1">Clue {{ clue_id }} of {{ GAME_SETTINGS.FINAL_CLUE_ID }}</div>
          </div>
          <div class="text-nowrap small">
            Elapsed: <span id="elapsedTimer">00:00</span>
          </div>
        </div>
      </div>
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="mb-3">
            {% if clue and clue.image_filename %}
              <img src="{{ url_for('serve_upload', filename=clue.image_filename) }}"
                   alt="{{ clue.image_alt or 'Clue image' }}"
                   class="img-fluid rounded pastel-border mb-2">
              {% if clue.image_caption %}
                <div class="muted small mb-2">{{ clue.image_caption }}</div>
              {% endif %}
            {% endif %}
            <p class="lead mb-2">{{ body_text }}</p>
          </div>

          {% if hint_text %}
            {% if hint_revealed %}
              <div class="alert alert-warning" role="alert">
                <strong>Hint:</strong> {{ hint_text }}
              </div>
            {% else %}
              <div class="alert alert-warning small" role="alert">
                Use the "Use Hint" button to reveal the hint.
              </div>
            {% endif %}
          {% endif %}

          <div class="d-flex flex-wrap align-items-end gap-2 mt-3">
            <form method="post" action="{{ url_for('hint', id=clue_id) }}">
              <button id="hintBtn" type="submit" class="btn btn-outline-info btn-lg mb-3" aria-label="Use hint"
                      data-hint-delay="{{ GAME_SETTINGS.HINT_DELAY_SECONDS }}" {% if not hint_revealed %}disabled{% endif %}>
                <span id="hintBtnLabel">{% if hint_revealed %}Use Hint{% else %}Hint (available in <span id="hintCountdown">{{ GAME_SETTINGS.HINT_DELAY_SECONDS }}</span> s){% endif %}</span>
              </button>
            </form>

            <form method="post" action="{{ url_for('skip', id=clue_id) }}">
              <button type="submit" class="btn btn-outline-warning btn-lg mb-3" aria-label="Skip this clue">Skip</button>
            </form>

            {% if answer_type == "text" %}
              <form method="post" action="{{ url_for('submit', id=clue_id) }}" class="d-flex flex-wrap gap-2">
                <label for="answerField" class="visually-hidden">Answer</label>
                <input id="answerField" type="text" class="form-control form-control-lg" name="answer" placeholder="Enter answer" required aria-label="Answer">
                <button type="submit" class="btn btn-success btn-lg mb-3" aria-label="Submit answer">Submit Answer</button>
              </form>
            {% else %}
              <form method="post" action="{{ url_for('submit', id=clue_id) }}">
                <button type="submit" class="btn btn-success btn-lg mb-3" aria-label="Mark as found and go to next">I found it / Next</button>
              </form>
            {% endif %}

            <a href="{{ url_for('index') }}" class="btn btn-link" aria-label="Back to Home">Back to Home</a>
          </div>
        </div>
      </div>

      <div class="small text-muted">
        Variant is chosen deterministically from your team token and the clue number.
      </div>
    </div>
  </div>
{% endblock %}
